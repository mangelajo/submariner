#!/bin/bash
set -e

cd $(dirname $0)/..

source scripts/lib/find_functions

EXCLUDE_PKG_DIRS=".git .trash-cache vendor bin"

PACKAGES=$(find_go_pkg_dirs --no-trailing-dots "*.go")

if [[ $(goimports -l ${PACKAGES} | wc -l) -gt 0 ]]; then
    echo Incorrect formatting, please run goimports
    exit 1
fi

# grab e2e-test only related packages to avoid linting
# errors for packages we didn't vendor.
go get -t ./test/e2e/...

golangci-lint run -D megacheck -E unused,gosimple,staticcheck
